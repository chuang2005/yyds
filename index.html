import tkinter as tk
import time
import random
import threading
import math

# 配置参数
POPUP_WIDTH = 150
POPUP_HEIGHT = 60
SPAWN_DELAY = 0.08      # 每个弹窗的间隔时间（秒）
HEART_SCALE = 25        # 心形大小缩放
HEART_OFFSET_Y = -100   # 心形在屏幕上的垂直偏移

# 随机提示语和背景色
tips = [
    "记得吃水果", "保持微笑", "多喝水", "早点睡",
    "别熬夜", "多运动", "开心一点", "你超棒的",
    "爱自己", "今天也要加油", "想你了", "520"
]

bg_colors = [
    "#ffb6c1", "#ffc0cb", "#ff69b4", "#ff1493",
    "#ff8c94", "#ff9eb6", "#ffb3d9", "#ffc6e5",
    "#ffd9ec", "#ffe6f2", "#ff66b2", "#ff80cc"
]

def heart_x(t, size=HEART_SCALE):
    return size * (16 * (math.sin(t) ** 3))

def heart_y(t, size=HEART_SCALE):
    return -size * (13 * math.cos(t) - 5 * math.cos(2*t) - 2 * math.cos(3*t) - math.cos(4*t))

def generate_heart_points():
    """生成爱心形状的坐标点"""
    points = []
    screen_width = root.winfo_screenwidth()
    screen_height = root.winfo_screenheight()
    center_x = screen_width // 2
    center_y = screen_height // 2 + HEART_OFFSET_Y

    t = 0
    while t < 2 * math.pi:
        x = heart_x(t)
        y = heart_y(t)
        # 转换为屏幕坐标
        screen_x = int(center_x + x)
        screen_y = int(center_y + y)
        # 确保窗口在屏幕内
        screen_x = max(POPUP_WIDTH//2, min(screen_x, screen_width - POPUP_WIDTH//2))
        screen_y = max(POPUP_HEIGHT//2, min(screen_y, screen_height - POPUP_HEIGHT//2))
        points.append((screen_x, screen_y))
        t += 0.1
    return points

def create_popup(x, y, is_last=False):
    """创建单个弹窗"""
    window = tk.Toplevel(root)
    window.title("")
    window.geometry(f"{POPUP_WIDTH}x{POPUP_HEIGHT}+{x-POPUP_WIDTH//2}+{y-POPUP_HEIGHT//2}")
    window.resizable(False, False)

    # 设置随机背景色和提示语
    bg_color = random.choice(bg_colors)
    tip_text = random.choice(tips)

    window.configure(bg=bg_color)
    label = tk.Label(
        window,
        text=tip_text,
        bg=bg_color,
        fg="white",
        font=("微软雅黑", 11, "bold"),
        wraplength=POPUP_WIDTH - 20,
        justify="center"
    )
    label.pack(expand=True, fill="both")

    # 最后一个弹窗点击关闭所有窗口
    if is_last:
        def close_all():
            root.destroy()
        window.protocol("WM_DELETE_WINDOW", close_all)

def popup_heart():
    """逐个弹出爱心窗口"""
    points = generate_heart_points()
    total = len(points)
    for i, (x, y) in enumerate(points):
        if root.quit_requested:
            break
        is_last = (i == total - 1)
        root.after(0, create_popup, x, y, is_last)
        time.sleep(SPAWN_DELAY)

if __name__ == "__main__":
    root = tk.Tk()
    root.withdraw()  # 隐藏主窗口
    root.quit_requested = False

    # 在新线程中运行弹窗，避免阻塞主循环
    threading.Thread(target=popup_heart, daemon=True).start()

    # 主循环
    root.mainloop()
